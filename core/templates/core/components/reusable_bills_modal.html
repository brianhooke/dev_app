{% load static %}

<!-- Bills Modal -->
<div class="modal fade" id="billsModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document" style="max-width: 95%; max-height: 95vh; margin: 2.5vh auto;">
        <div class="modal-content" style="border: 3px solid black; height: 95vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="text-align: center; background: var(--gradient-primary-45deg); flex-shrink: 0;">
                <h5 class="modal-title" id="billsModalTitle">Bills</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="flex: 1; overflow: hidden; padding: 0; display: flex; flex-direction: column;">
                {% block bills_modal_body %}
                <div style="display: flex; height: 100%;">
                    <!-- Left side: Table (60%) -->
                    <div style="width: 60%; padding: 15px; overflow-y: auto; border-right: 2px solid #ddd;">
                        <table class="table table-bordered table-hover" id="billsTable">
                            <thead>
                                <tr>
                                    <th>Xero Instance / Project</th>
                                    <th>Supplier</th>
                                    <th>Invoice #</th>
                                    <th>$ Net</th>
                                    <th>$ GST</th>
                                    <th>Email</th>
                                    <th>Send</th>
                                    <th id="lastColumnHeader">Archive</th>
                                </tr>
                            </thead>
                            <tbody id="billsTableBody">
                                <!-- Bills will be populated here via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Right side: Allocations table (1/3) and iViewer (2/3) (40%) -->
                    <div style="width: 40%; padding: 15px; display: flex; flex-direction: column;">
                        <!-- Allocations table (top 1/3) - only visible in Direct modal -->
                        <div id="allocationsSection" style="height: 33%; display: none; flex-direction: column; margin-bottom: 15px;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                <h6 id="allocationsTitle">Invoice Allocations</h6>
                            </div>
                            <div style="flex: 1; overflow-y: auto; border: 2px solid #ddd;">
                                <table class="table table-bordered table-sm" id="allocationsTable" style="margin-bottom: 0;">
                                    <thead>
                                        <tr>
                                            <th>Xero Account</th>
                                            <th>Division</th>
                                            <th>$ Net</th>
                                            <th>$ GST</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allocationsTableBody">
                                        <!-- Allocations will be populated here via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 5px; text-align: center;">
                                <button type="button" class="btn btn-sm btn-success" id="addAllocationBtn">
                                    <i class="fas fa-plus"></i> Add Row
                                </button>
                            </div>
                        </div>
                        
                        <!-- iViewer (bottom 2/3) -->
                        <div id="viewerSection" style="flex: 1; display: flex; flex-direction: column;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                <h6 id="viewerTitle">Select a bill to preview</h6>
                            </div>
                            <div style="flex: 1; border: 2px solid #ddd; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                                <iframe 
                                    id="billViewer" 
                                    style="width: 100%; height: 100%; border: none; display: none;"
                                    allow="fullscreen"
                                    src="">
                                </iframe>
                                <div id="viewerPlaceholder" style="text-align: center; color: #6c757d;">
                                    <i class="fas fa-file-pdf" style="font-size: 64px; margin-bottom: 10px;"></i>
                                    <p>Click on a bill to view the attachment</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endblock %}
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; flex-shrink: 0;">
                {% block bills_modal_footer %}
                <div>
                    <button type="button" class="btn btn-primary" id="saveBillsBtn">Save Changes</button>
                </div>
                <div>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
                {% endblock %}
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Bills modal JavaScript will be added in next prompt
});
</script>
