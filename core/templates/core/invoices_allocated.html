<!-- Allocated Invoices Section Template -->
<!-- Uses reusable allocations section with allocated invoice-specific configuration -->

{% include "core/components/reusable_allocations_section.html" with section_id="allocatedInvoice" main_table_columns=main_table_columns allocations_columns=allocations_columns allocations_title="Invoice Allocations" viewer_placeholder_text="Click on an invoice to view the PDF" viewer_placeholder_icon="fas fa-file-pdf" readonly=readonly %}

<!-- Allocated invoice-specific CSS overrides -->
<style>
    /* Action buttons styling */
    .allocated-action-btn {
        font-size: 10px;
        padding: 2px 6px;
        margin: 0 2px;
    }
    
    /* Re-apply compact table styles for renamed IDs (legacy compatibility) */
    #allocatedInvoicesTable {
        font-size: 12px;
    }
    
    #allocatedInvoicesTable th {
        padding: 6px 5px !important;
        font-size: 11px;
        white-space: nowrap;
        vertical-align: middle;
    }
    
    #allocatedInvoicesTable td {
        padding: 4px 5px !important;
        font-size: 11px;
        vertical-align: middle;
    }
    
    #allocatedInvoicesTable .form-control-sm {
        font-size: 11px;
        padding: 3px 5px;
        height: 28px;
        min-height: 28px;
    }
    
    #allocatedInvoicesTable input[type="text"],
    #allocatedInvoicesTable input[type="number"] {
        font-size: 11px;
        padding: 3px 5px;
        height: 28px;
    }
    
    #allocatedInvoicesTableFooter td {
        font-size: 11px;
    }
</style>

<!-- Legacy ID mappings for backwards compatibility with existing JavaScript -->
<script>
(function() {
    // Map new template IDs to legacy IDs expected by existing JavaScript
    const idMappings = {
        // Main table IDs
        'allocatedInvoiceMainTable': 'allocatedInvoicesTable',
        'allocatedInvoiceMainTableBody': 'allocatedInvoicesTableBody',
        'allocatedInvoiceMainTableFooter': 'allocatedInvoicesTableFooter',
        // Footer totals (FooterCol3 = $ Net, FooterCol4 = $ GST based on column order)
        'allocatedInvoiceFooterCol3': 'allocatedInvoicesNetTotal',
        'allocatedInvoiceFooterCol4': 'allocatedInvoicesGstTotal',
        // Allocations footer totals
        'allocatedInvoiceTotalNet': 'allocatedTotalNet',
        'allocatedInvoiceTotalGst': 'allocatedTotalGst'
    };
    
    // Rename IDs for backwards compatibility
    Object.entries(idMappings).forEach(([templateId, legacyId]) => {
        const element = document.getElementById(templateId);
        if (element) {
            element.id = legacyId;
        }
    });
    
    // Apply inline styles to allocations tbody rows for proper alignment
    // (CSS selectors use template IDs which are correct, but adding explicit styles for safety)
    const allocTbody = document.getElementById('allocatedInvoiceAllocationsTableBody');
    if (allocTbody) {
        const observer = new MutationObserver(function() {
            allocTbody.querySelectorAll('tr').forEach(function(row) {
                row.style.display = 'table';
                row.style.width = '100%';
                row.style.tableLayout = 'fixed';
            });
        });
        observer.observe(allocTbody, { childList: true });
    }
})();
</script>
