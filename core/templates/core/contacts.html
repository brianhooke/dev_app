{% load static %}

<!-- Extended Contacts Modal with XeroInstances dropdown, Pull Xero Contacts, and Delete button -->

<!-- Wrapper to override blocks in base modal -->
<div style="display: none;">
    {% block contacts_modal_body %}
    {% endblock %}
    {% block contacts_modal_footer %}
    {% endblock %}
</div>

<!-- Include base modal -->
{% include 'core/components/reusable_contacts_modal.html' %}

<!-- Override modal body and footer with JavaScript -->
<script>
    $(document).ready(function() {
        // Add XeroInstances dropdown to modal body
        const xeroDropdown = `
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="xeroInstanceSelect">Xero Instance:</label>
                <select class="form-control" id="xeroInstanceSelect">
                    {% for instance in xero_instances %}
                        <option value="{{ instance.xero_instance_pk }}" {% if forloop.first %}selected{% endif %}>
                            {{ instance.xero_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        `;
        
        // Insert dropdown before the table when modal is shown
        $('#contactsModal').on('show.bs.modal', function() {
            const modalBody = $(this).find('.modal-body > div[style*="overflow-x"]');
            if (!$(this).find('#xeroInstanceSelect').length) {
                modalBody.before(xeroDropdown);
            }
            
            // Add Delete button after Archive button if not already present
            const archiveBtn = $(this).find('#archiveContactBtn');
            if (archiveBtn.length && !$(this).find('#deleteContactBtn').length) {
                archiveBtn.after('<button type="button" class="btn btn-danger" id="deleteContactBtn" style="margin-left: 10px;">Delete</button>');
            }
        });
    });
</script>
