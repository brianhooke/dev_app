container_commands:
  01_create_env_file:
    command: |
      # Create .env file from Elastic Beanstalk environment variables
      echo "Creating .env file from EB environment variables..."
      
      # Read all EB environment variables and write to .env file
      env | grep -E '^(DJANGO_SETTINGS_MODULE|SECRET_KEY|RDS_|AWS_|PROJECT_NAME|LETTERHEAD_PATH|BACKGROUND_IMAGE_PATH|EMAIL_|DEFAULT_FROM_EMAIL|XERO_)' > /var/app/staging/.env
      
      # Make sure the file exists and has content
      if [ -f /var/app/staging/.env ]; then
        echo ".env file created with $(wc -l < /var/app/staging/.env) variables"
        echo "RDS_HOSTNAME is: $(grep '^RDS_HOSTNAME=' /var/app/staging/.env | cut -d'=' -f2- || echo 'NOT FOUND')"
      else
        echo "ERROR: .env file was not created"
      fi
    leader_only: true
