<!-- Construction View Template -->
<!-- This template contains the construction view structure for projects -->

<div class="construction-view-container" style="height: 100%; display: flex; flex-direction: column;">
    <!-- Back button and Project heading -->
    <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
        <button id="backToProjectsFromConstructionBtn" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Projects
        </button>
        <h3 id="constructionProjectName" style="margin: 0; flex: 1;"></h3>
    </div>
    
    <!-- Construction navigation buttons -->
    <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
        <button class="btn btn-primary construction-nav-btn" data-section="quotes">Quotes</button>
        <button class="btn btn-primary construction-nav-btn" data-section="documents">Documents</button>
        <button class="btn btn-primary construction-nav-btn" data-section="contract-budget">Contract Budget</button>
        
        <!-- Dynamic action buttons (shown based on selected section) -->
        <button id="constructionNewQuoteBtn" class="btn btn-success" style="display: none; margin-left: 10px;">
            <i class="fas fa-plus"></i> New Quote
        </button>
    </div>
    
    <!-- Hidden file input for quote PDF upload -->
    <input type="file" id="constructionQuotePdfInput" accept="application/pdf" style="display: none;">
    
    <!-- Construction content area -->
    <div id="constructionContentArea" style="flex: 1; border: 2px solid #ddd; padding: 20px; overflow-y: auto;">
        <p style="text-align: center; color: #6c757d;">Select a section above to view content.</p>
    </div>
</div>

<style>
    /* Construction view specific styles */
    .construction-view-container {
        padding: 0;
        margin: 0;
    }
    
    .construction-nav-btn {
        transition: all 0.2s ease;
    }
    
    .construction-nav-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    #constructionContentArea {
        background-color: white;
        position: relative;
        z-index: 1;
    }
</style>

<script>
    // Construction view JavaScript functionality
    $(document).ready(function() {
        console.log('Construction template loaded');
        
        // Handle Construction navigation button clicks
        $(document).on('click', '.construction-nav-btn', function() {
            const section = $(this).data('section');
            console.log(`Construction section clicked: ${section}`);
            
            // Remove active class from all buttons
            $('.construction-nav-btn').removeClass('btn-primary').addClass('btn-outline-primary');
            
            // Add active class to clicked button
            $(this).removeClass('btn-outline-primary').addClass('btn-primary');
            
            // Hide all dynamic action buttons first
            $('#constructionNewQuoteBtn').hide();
            
            // Update content area based on section
            if (section === 'quotes') {
                loadConstructionQuotesSection();
            } else if (section === 'documents') {
                loadConstructionDocumentsSection();
            } else if (section === 'contract-budget') {
                loadConstructionContractBudgetSection();
            }
        });
        
        // Load construction quotes section
        function loadConstructionQuotesSection() {
            // Show New Quote button
            $('#constructionNewQuoteBtn').show();
            
            // Show Committed Quotes view
            $('#constructionContentArea').html(`
                <div style="display: flex; height: 100%; gap: 15px;">
                    <div style="width: 60%; height: 100%;">
                        <div style="height: 100%; overflow-y: auto; border: 1px solid #ddd;">
                            <table id="constructionCommittedQuotesTable" class="reusable-table" style="margin-bottom: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">Quote #</th>
                                        <th style="width: 35%;">Supplier</th>
                                        <th style="width: 20%;">Total Cost</th>
                                        <th style="width: 10%;">Update</th>
                                        <th style="width: 10%;">Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">
                                            Construction quotes section - functionality to be implemented
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div style="width: 40%; height: 100%;">
                        <iframe id="constructionQuotePdfViewer" style="width: 100%; height: 100%; border: 1px solid #ddd;" src=""></iframe>
                    </div>
                </div>
            `);
        }
        
        // Load construction documents section
        function loadConstructionDocumentsSection() {
            if (!window.currentConstructionProject || !window.currentConstructionProject.pk) {
                console.error('No construction project selected');
                return;
            }
            
            // Use shared documents template
            var documentsHtml = $('#documentsTemplateStorage').html();
            $('#constructionContentArea').html(documentsHtml);
            
            // Initialize DocumentsManager module
            if (typeof DocumentsManager !== 'undefined') {
                DocumentsManager.init({
                    projectPk: window.currentConstructionProject.pk
                });
            }
            
            console.log('Construction documents section loaded for project:', window.currentConstructionProject.pk);
        }
        
        // Load construction contract budget section
        function loadConstructionContractBudgetSection() {
            if (!window.currentConstructionProject || !window.currentConstructionProject.pk) {
                console.error('No construction project selected');
                return;
            }
            
            // Use shared contract budget template
            var contractBudgetHtml = $('#contractBudgetTemplateStorage').html();
            $('#constructionContentArea').html(contractBudgetHtml);
            
            console.log('Construction contract budget section loaded for project:', window.currentConstructionProject.pk);
        }
    });
</script>
